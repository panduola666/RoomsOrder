import{a as q,S as D,f as V,_ as H}from"./validate-ytR7GtdT.js";import{d as A,r as n,j as l,c as d,b as e,x as c,F as y,s as x,w as J,e as p,v as $,z as G,p as M,l as O,_ as R,o as Z,m as F,n as K,q as C,t as Q,u as W,y as B,A as E,B as X}from"./index-KlImFblv.js";import{C as U}from"./cityCountyData-3AYHRziG.js";const ee="/RoomsOrder/assets/Avatar _6-2mSuCy2l.png",N=v=>(M("data-v-92161c11"),v=v(),O(),v),se=N(()=>e("h2",{class:"fs-6 fs-lg-5 mb-5 mb-lg-7 fw-bold"},"修改密碼",-1)),te=N(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"電子信箱",-1)),ae={class:"mb-3 mb-lg-5 fw-bold"},le={key:0,class:"d-flex align-items-center gap-3"},oe={class:"flex-grow-1"},de=N(()=>e("p",{class:"mb-2 text-neutral-80 fw-medium"},"密碼",-1)),ne={class:"mb-3 mb-lg-5"},re=N(()=>e("label",{for:"password",class:"form-label fw-bold"},"舊密碼",-1)),ie={class:"mb-3 mb-lg-5"},ue=N(()=>e("label",{for:"newPassword",class:"form-label fw-bold"},"新密碼",-1)),ce={class:"mb-5 mb-lg-7"},me=N(()=>e("label",{for:"checkPwd",class:"form-label fw-bold"},"確認新密碼",-1)),pe=A({__name:"EditPwd",setup(v){const f=n(!1),r=JSON.parse(localStorage.getItem("user")),t=n({userId:r._id,email:r.email,oldPassword:"",newPassword:""}),i=n(""),b=V();async function h(){if(!q(t.value.newPassword,i.value))return;const _=await b._fetch("/api/v1/user/","PUT",t.value);D.fire({icon:_.status?"success":"error",title:_.status?"修改密碼成功":_.message}),_.status&&(f.value=!1,t.value.newPassword=t.value.oldPassword=i.value="")}return(_,m)=>(l(),d("div",null,[se,te,e("p",ae,c(t.value.email),1),f.value?(l(),d("form",{key:1,onSubmit:J(h,["prevent"])},[e("div",ne,[re,p(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"password",placeholder:"請輸入舊密碼","onUpdate:modelValue":m[1]||(m[1]=u=>t.value.oldPassword=u),autocomplete:"off"},null,512),[[$,t.value.oldPassword]])]),e("div",ie,[ue,p(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"newPassword",placeholder:"請輸入新密碼","onUpdate:modelValue":m[2]||(m[2]=u=>t.value.newPassword=u),autocomplete:"off"},null,512),[[$,t.value.newPassword]])]),e("div",ce,[me,p(e("input",{type:"password",class:"form-control p-3 rounded-3",id:"checkPwd",placeholder:"請再輸入一次新密碼","onUpdate:modelValue":m[3]||(m[3]=u=>i.value=u),autocomplete:"off"},null,512),[[$,i.value]])]),e("input",{type:"submit",class:G(["btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",{disabled:!t.value.oldPassword||!t.value.oldPassword||!i.value}]),value:"儲存設定"},null,2)],32)):(l(),d("div",le,[e("div",oe,[de,(l(),d(y,null,x(10,u=>e("i",{class:"pwdPoint d-inline-block bg-black rounded-circle me-2",key:u})),64))]),e("span",{class:"text-primary pointer text-decoration-underline",onClick:m[0]||(m[0]=u=>f.value=!0)},"重設")]))]))}}),ve=R(pe,[["__scopeId","data-v-92161c11"]]),fe=e("h2",{class:"fs-6 fs-lg-5 fw-bold mb-5 mb-lg-7"},"基本資料",-1),_e={key:0},be=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"姓名",-1),we={class:"mb-3 mb-lg-5 fw-bold"},he=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"手機號碼",-1),ge={class:"mb-3 mb-lg-5 fw-bold"},ye=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"生日",-1),xe={class:"mb-3 mb-lg-5 fw-bold"},$e=e("p",{class:"mb-2 text-neutral-80 fw-medium"},"地址",-1),Ne={class:"mb-5 mb-lg-7 fw-bold"},ke={class:"mb-5"},Ce=e("label",{for:"userName",class:"form-label fw-bold"},"姓名",-1),Pe={class:"mb-5"},Se=e("label",{for:"userName",class:"form-label fw-bold"},"手機號碼",-1),Ie={class:"mb-5"},Ue=e("label",{for:"birth",class:"form-label fw-bold"},"生日",-1),De={class:"d-flex gap-2"},Ve=["value"],Ae=["value"],ze=["value"],Le={class:"mb-5 mb-lg-7"},Fe=e("label",{for:"address",class:"form-label fw-bold"},"地址",-1),Be={class:"d-flex gap-2 mb-3"},Ee=["value"],Je=["value"],Me=e("input",{type:"submit",class:"btn btn-primary py-3 px-6 rounded-3 w-100 w-lg-auto",value:"儲存設定"},null,-1),Oe=A({__name:"UserInfo",setup(v){const f=n(!1),r=JSON.parse(localStorage.getItem("user")),t=n({userId:r._id,name:r.name,phone:r.phone,birthday:new Date(r.birthday).toLocaleDateString(),address:{zipcode:r.address.zipcode,detail:r.address.detail}}),i=n(""),b=V();async function h(){t.value.birthday=`${g.value}/${w.value}/${P.value}`;const o=await b._fetch("/api/v1/user/","PUT",t.value);if(D.fire({icon:o.status?"success":"error",title:o.status?"個資修改成功":o.message}),o.status){localStorage.setItem("user",JSON.stringify(o.result)),f.value=!1;const{address:a,birthday:k,name:s,phone:j}=o.result;t.value.name=s,t.value.phone=j,t.value.address=a,t.value.birthday=new Date(k).toLocaleDateString(),m()}}const _=n({CityName:"",CityEngName:"",AreaList:[]});Z(()=>{U.forEach(o=>{o.AreaList.find(k=>Number(k.ZipCode)===r.address.zipcode)&&(I.value=o.CityName,_.value=o)}),Y(),m()});function m(){const o=t.value.address;i.value=_.value.CityName+_.value.AreaList.find(a=>Number(a.ZipCode)===o.zipcode).AreaName+o.detail}const u=t.value.birthday.split("/"),g=n(Number(u[0])),w=n(Number(u[1])),P=n(Number(u[2])),S=n(31),z=()=>{w.value===2?S.value=g.value%4?28:29:[1,3,5,7,8,10,12].includes(w.value)?S.value=31:S.value=30};F(()=>g.value,z),F(()=>w.value,z);const L=n([]),I=n(""),Y=()=>{const o=U.find(a=>a.CityName===I.value);L.value=o.AreaList};return(o,a)=>{const k=K("tel");return l(),d("div",null,[fe,f.value?(l(),d("form",{key:1,onSubmit:J(h,["prevent"])},[e("div",ke,[Ce,p(e("input",{type:"text",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入姓名","onUpdate:modelValue":a[1]||(a[1]=s=>t.value.name=s)},null,512),[[$,t.value.name]])]),e("div",Pe,[Se,p(e("input",{type:"tel",class:"form-control p-3 rounded-3",id:"userName",placeholder:"請輸入手機號碼","onUpdate:modelValue":a[2]||(a[2]=s=>t.value.phone=s)},null,512),[[$,t.value.phone],[k]])]),e("div",Ie,[Ue,e("div",De,[p(e("select",{id:"birth",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[3]||(a[3]=s=>g.value=s)},[(l(),d(y,null,x(100,s=>e("option",{key:s,value:new Date().getFullYear()-(100-s)},c(new Date().getFullYear()-(100-s))+" 年 ",9,Ve)),64))],512),[[C,g.value]]),p(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[4]||(a[4]=s=>w.value=s)},[(l(),d(y,null,x(12,s=>e("option",{key:s,value:s},c(s)+" 月",9,Ae)),64))],512),[[C,w.value]]),p(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[5]||(a[5]=s=>P.value=s)},[(l(!0),d(y,null,x(S.value,s=>(l(),d("option",{key:s,value:s},c(s)+" 日",9,ze))),128))],512),[[C,P.value]])])]),e("div",Le,[Fe,e("div",Be,[p(e("select",{id:"address",class:"form-select p-3 rounded-3","onUpdate:modelValue":a[6]||(a[6]=s=>I.value=s)},[(l(!0),d(y,null,x(Q(U),s=>(l(),d("option",{key:s.CityName,value:s.CityName},c(s.CityName),9,Ee))),128))],512),[[C,I.value]]),p(e("select",{class:"form-select p-3 rounded-3","onUpdate:modelValue":a[7]||(a[7]=s=>t.value.address.zipcode=s)},[(l(!0),d(y,null,x(L.value,s=>(l(),d("option",{key:s.ZipCode,value:s.ZipCode},c(s.AreaName),9,Je))),128))],512),[[C,t.value.address.zipcode]])]),p(e("input",{type:"text",class:"form-control p-3 rounded-3",placeholder:"請輸入詳細地址","onUpdate:modelValue":a[8]||(a[8]=s=>t.value.address.detail=s)},null,512),[[$,t.value.address.detail]])]),Me],32)):(l(),d("div",_e,[be,e("p",we,c(t.value.name),1),he,e("p",ge,c(t.value.phone),1),ye,e("p",xe,c(g.value)+" 年 "+c(w.value)+" 月 "+c(P.value)+" 日",1),$e,e("p",Ne,c(i.value),1),e("input",{type:"button",class:"btn btn-outline-primary py-3 px-6 fw-bold",value:"編輯",onClick:a[0]||(a[0]=s=>f.value=!0)})]))])}}}),T=v=>(M("data-v-042feff1"),v=v(),O(),v),Re={class:"bg-neutral-bg"},Ze=X('<div class="userBanner" data-v-042feff1><div class="container position-relative z-3" data-v-042feff1><div class="d-lg-flex flex-lg-row align-items-center gap-5 fs-1 fw-bold text-white py-7 py-lg-10" data-v-042feff1><img src="'+ee+'" alt="" class="avatar mb-3 mb-lg-0" data-v-042feff1><h1 class="fs-1 fw-bold mb-0" data-v-042feff1>Hello，Jessica</h1></div></div></div>',1),Te={class:"container my-7 mt-lg-9 mb-lg-10"},Ye=T(()=>e("ul",{class:"tabs d-flex text-white fw-bold p-0 mb-7 mb-lg-9"},[e("li",{class:"tabs-item px-5 py-3 pointer active"},"個人資料"),e("li",{class:"tabs-item px-5 py-3 pointer"},"我的訂單")],-1)),je={class:"row g-5 g-lg-7"},qe={class:"col-12 col-lg-5"},He={class:"bg-white p-5 p-lg-7 rounded-6"},Ge={class:"col-12 col-lg-7"},Ke={class:"bg-white p-5 p-lg-7 rounded-6"},Qe=T(()=>e("img",{src:H,alt:"Line",class:"line"},null,-1)),We=A({__name:"UserView",setup(v){const f=W(),r=V(),t=n({_id:"",updatedAt:"",phone:"",name:"",email:"",createdAt:"",birthday:"",address:{detail:"",zipcode:0}});return Z(async()=>{const i=await r._fetch("/api/v1/user/check");if(!i.status){const h=await D.fire({icon:"error",title:i.message});(h.isConfirmed||h.isDismissed)&&(localStorage.removeItem("token"),f.push("/login"));return}const b=await r._fetch("/api/v1/user");localStorage.setItem("user",JSON.stringify(b.result)),t.value=b.result}),(i,b)=>(l(),d("main",Re,[Ze,e("div",Te,[Ye,e("div",je,[e("div",qe,[e("section",He,[t.value._id?(l(),B(ve,{key:0})):E("",!0)])]),e("div",Ge,[e("section",Ke,[t.value._id?(l(),B(Oe,{key:0})):E("",!0)])])])]),Qe]))}}),ts=R(We,[["__scopeId","data-v-042feff1"]]);export{ts as default};
